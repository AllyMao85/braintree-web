!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(t.braintree||(t.braintree={})).unionpay=e()}}(function(){return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[a]={exports:{}};t[a][0].call(d.exports,function(e){var n=t[a][1][e];return i(n?n:e)},d,d.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";function r(e,t){var n,r=t?o(t):{},s=i(e.authorization).attrs,u=o(e.analyticsMetadata);r.braintreeLibraryVersion=a.BRAINTREE_LIBRARY_VERSION;for(n in r._meta)r._meta.hasOwnProperty(n)&&(u[n]=r._meta[n]);return r._meta=u,s.clientKey?r.clientKey=s.clientKey:r.authorizationFingerprint=s.authorizationFingerprint,r}var i=e("./create-authorization-data"),o=e("./json-clone"),a=e("./constants");t.exports=r},{"./constants":3,"./create-authorization-data":4,"./json-clone":7}],2:[function(e,t,n){"use strict";function r(e){return Math.floor(e/1e3)}function i(e){return e}function o(e,t,n){var o=e.getConfiguration(),u=e._driver,c=r(Date.now()),d=o.gatewayConfiguration.analytics.url,l={analytics:[{kind:t,timestamp:c}]};u.post(d,s(o,l),i,n,a.ANALYTICS_REQUEST_TIMEOUT_MS)}var a=e("./constants"),s=e("./add-metadata");t.exports={sendEvent:o}},{"./add-metadata":1,"./constants":3}],3:[function(e,t,n){"use strict";var r="3.0.0-beta.5",i="web";t.exports={ANALYTICS_REQUEST_TIMEOUT_MS:2e3,INTEGRATION_TIMEOUT_MS:6e4,VERSION:r,INTEGRATION:"custom",SOURCE:"client",PLATFORM:i,BRAINTREE_LIBRARY_VERSION:"braintree/"+i+"/"+r}},{}],4:[function(e,t,n){"use strict";function r(e){return/^[a-zA-Z0-9]+_[a-zA-Z0-9]+_[a-zA-Z0-9_]+$/.test(e)}function i(e){var t=e.split("_"),n=t[0],r=t.slice(2).join("_");return{merchantId:r,environment:n}}function o(e){var t,n,o={attrs:{},configUrl:""};return r(e)?(n=i(e),o.attrs.clientKey=e,o.configUrl=s[n.environment]+"/merchants/"+n.merchantId+"/client_api/v1/configuration"):(t=JSON.parse(a(e)),o.attrs.authorizationFingerprint=t.authorizationFingerprint,o.configUrl=t.configUrl),o}var a=e("../lib/polyfill").atob,s={production:"https://api.braintreegateway.com:443",sandbox:"https://api.sandbox.braintreegateway.com:443"};t.exports=o},{"../lib/polyfill":8}],5:[function(e,t,n){"use strict";function r(e,t){return t=null==t?"":t,e.reduce(function(e,n){return e[n]=t+n,e},{})}t.exports=r},{}],6:[function(e,t,n){"use strict";function r(e){if(!r.types.hasOwnProperty(e.type))throw new Error(e.type+" is not a valid type");if(!e.message)throw new Error("Error message required");this.message=e.message,this.type=e.type,this.details=e.details}var i=e("./enumerate");r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r.types=i(["CUSTOMER","MERCHANT","NETWORK","INTERNAL","UNKNOWN"]),t.exports=r},{"./enumerate":5}],7:[function(e,t,n){"use strict";t.exports=function(e){return JSON.parse(JSON.stringify(e))}},{}],8:[function(e,t,n){(function(e){"use strict";function n(e){var t,n,r,i,o,a,s,u,c=new RegExp("^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{4})([=]{1,2})?$"),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="";if(!c.test(e))throw new Error("Non base64 encoded input passed to window.atob polyfill");u=0;do i=d.indexOf(e.charAt(u++)),o=d.indexOf(e.charAt(u++)),a=d.indexOf(e.charAt(u++)),s=d.indexOf(e.charAt(u++)),t=(63&i)<<2|o>>4&3,n=(15&o)<<4|a>>2&15,r=(3&a)<<6|63&s,l+=String.fromCharCode(t)+(n?String.fromCharCode(n):"")+(r?String.fromCharCode(r):"");while(u<e.length);return l}var r="function"==typeof e.atob?e.atob:n;t.exports={atob:r,_atob:n}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(e,t,n){"use strict";function r(e,t){var n;if("function"!=typeof t)throw new o({type:o.types.MERCHANT,message:"UnionPay creation requires a callback"});return null==e.client?void t(new o({type:o.types.MERCHANT,message:"options.client is required when instantiating UnionPay"})):(n=e.client.getConfiguration(),n.gatewayConfiguration.unionPay&&n.gatewayConfiguration.unionPay.enabled===!0?(a.sendEvent(e.client,"web.unionpay.initialized"),void t(null,new i(e))):void t(new o({type:o.types.MERCHANT,message:"UnionPay is not enabled for this merchant"})))}var i=e("./unionpay"),o=e("../../lib/error"),a=e("../../lib/analytics");t.exports=r},{"../../lib/analytics":2,"../../lib/error":6,"./unionpay":10}],10:[function(e,t,n){"use strict";function r(e){this._options=e,this._merchantAccountId=e.client.getConfiguration().gatewayConfiguration.unionPay.merchantAccountId}var i=e("../../lib/error"),o=e("../../lib/analytics");r.prototype.fetchCapabilities=function(e,t){var n=this._options.client,r=e.cardNumber;return r?void n.request({method:"get",endpoint:"payment_methods/credit_cards/capabilities",data:{_meta:{source:"unionpay"},creditCard:{number:r}}},function(e,r){return e?(t(new i({type:i.types.NETWORK,message:"Fetch capabilities network error",details:{originalError:e}})),void o.sendEvent(n,"web.unionpay.capabilities-failed")):(o.sendEvent(n,"web.unionpay.capabilities-received"),void t(null,r))}):void t(new i({type:i.types.MERCHANT,message:"A card number is required"}))},r.prototype.enroll=function(e,t){var n=this._options.client,r=e.card,a={_meta:{source:"unionpay"},unionPayEnrollment:{number:r.number,expirationMonth:r.expirationMonth,expirationYear:r.expirationYear,mobileCountryCode:r.mobileCountryCode,mobileNumber:r.mobileNumber}};this._merchantAccountId&&(a.merchantAccountId=this._merchantAccountId),n.request({method:"post",endpoint:"union_pay_enrollments",data:a},function(e,r){var a;return e?(e.type===i.types.CUSTOMER?a="Enrollment invalid due to customer input error":(e.type=i.types.NETWORK,a="Enrollment network error"),o.sendEvent(n,"web.unionpay.enrollment-failed"),void t(new i({type:e.type,message:a,details:{originalError:e}}))):(o.sendEvent(n,"web.unionpay.enrollment-succeeded"),void t(null,{unionPayEnrollmentId:r.unionPayEnrollmentId}))})},r.prototype.tokenize=function(e,t){var n,r=this._options.client;r.request({method:"post",endpoint:"payment_methods/credit_cards",data:{_meta:{source:"unionpay"},creditCard:{number:e.card.number,expirationMonth:e.card.expirationMonth,expirationYear:e.card.expirationYear,cvv:e.card.cvv},options:e.options}},function(e,a){return e?(o.sendEvent(r,"web.unionpay.nonce-failed"),void t(new i({type:i.types.NETWORK,message:"Tokenization network error",details:{originalError:e}}))):(n=a.creditCards[0],delete n.consumed,delete n.threeDSecureInfo,delete n.type,o.sendEvent(r,"web.unionpay.nonce-received"),void t(null,n))})},t.exports=r},{"../../lib/analytics":2,"../../lib/error":6}],11:[function(e,t,n){"use strict";var r=e("./external/create"),i="3.0.0-beta.5";t.exports={create:r,VERSION:i}},{"./external/create":9}]},{},[11])(11)});
