!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(t.braintree||(t.braintree={})).unionpay=e()}}(function(){var e;return function t(e,n,r){function i(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){var n=e[s][1][t];return i(n?n:t)},l,l.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,n,r){"use strict";!function(t,i){"object"==typeof r&&"undefined"!=typeof n?n.exports=i():"function"==typeof e&&e.amd?e([],i):t.framebus=i()}(this,function(){function e(e){return null==e?!1:null==e.Window?!1:e.constructor!==e.Window?!1:(m.push(e),!0)}function t(e){var t,n={};for(t in E)E.hasOwnProperty(t)&&(n[t]=E[t]);return n._origin=e||"*",n}function n(e){var t,n,r=o(this);return s(e)?!1:s(r)?!1:(n=Array.prototype.slice.call(arguments,1),t=a(e,n,r),t===!1?!1:(y(v.top,t,r),!0))}function r(e,t){var n=o(this);return b(e,t,n)?!1:(_[n]=_[n]||{},_[n][e]=_[n][e]||[],_[n][e].push(t),!0)}function i(e,t){var n,r,i=o(this);if(b(e,t,i))return!1;if(r=_[i]&&_[i][e],!r)return!1;for(n=0;n<r.length;n++)if(r[n]===t)return r.splice(n,1),!0;return!1}function o(e){return e&&e._origin||"*"}function s(e){return"string"!=typeof e}function a(e,t,n){var r=!1,i={event:e,origin:n},o=t[t.length-1];"function"==typeof o&&(i.reply=g(o,n),t=t.slice(0,-1)),i.args=t;try{r=x+JSON.stringify(i)}catch(s){throw new Error("Could not stringify event: "+s.message)}return r}function u(e){var t,n,r,i;if(e.data.slice(0,x.length)!==x)return!1;try{t=JSON.parse(e.data.slice(x.length))}catch(o){return!1}return null!=t.reply&&(n=e.origin,r=e.source,i=t.reply,t.reply=function(e){var t=a(i,[e],n);return t===!1?!1:void r.postMessage(t,n)},t.args.push(t.reply)),t}function c(e){v||(v=e||window,v.addEventListener?v.addEventListener("message",f,!1):v.attachEvent?v.attachEvent("onmessage",f):null===v.onmessage?v.onmessage=f:v=null)}function l(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})}function f(e){var t;s(e.data)||(t=u(e),t&&(p("*",t.event,t.args,e),p(e.origin,t.event,t.args,e),h(e.data,t.origin,e.source)))}function p(e,t,n,r){var i;if(_[e]&&_[e][t])for(i=0;i<_[e][t].length;i++)_[e][t][i].apply(r,n)}function d(e){return e.top!==e?!1:null==e.opener?!1:e.opener===e?!1:e.opener.closed===!0?!1:!0}function y(e,t,n){var r;try{for(e.postMessage(t,n),d(e)&&y(e.opener.top,t,n),r=0;r<e.frames.length;r++)y(e.frames[r],t,n)}catch(i){}}function h(e,t,n){var r,i;for(r=m.length-1;r>=0;r--)i=m[r],i.closed===!0?m=m.slice(r,1):n!==i&&y(i.top,e,t)}function g(e,t){function n(i,o){e(i,o),E.target(t).unsubscribe(r,n)}var r=l();return E.target(t).subscribe(r,n),r}function b(e,t,n){return s(e)?!0:"function"!=typeof t?!0:s(n)?!0:!1}var v,E,m=[],_={},x="/*framebus*/";return c(),E={target:t,include:e,publish:n,pub:n,trigger:n,emit:n,subscribe:r,sub:r,on:r,unsubscribe:i,unsub:i,off:i}})},{}],2:[function(e,t,n){"use strict";var r=e("lodash/object/assign"),i=e("lodash/lang/isString"),o=e("setattributes"),s=e("./lib/default-attributes");t.exports=function(e){var t=document.createElement("iframe"),n=r({},s,e);return n.style&&!i(n.style)&&(r(t.style,n.style),delete n.style),o(t,n),t.getAttribute("id")||(t.id=t.name),t}},{"./lib/default-attributes":3,"lodash/lang/isString":24,"lodash/object/assign":25,setattributes:29}],3:[function(e,t,n){t.exports={src:"about:blank",frameBorder:0,allowtransparency:!0,scrolling:"no"}},{}],4:[function(e,t,n){function r(e,t){if("function"!=typeof e)throw new TypeError(i);return t=o(void 0===t?e.length-1:+t||0,0),function(){for(var n=arguments,r=-1,i=o(n.length-t,0),s=Array(i);++r<i;)s[r]=n[t+r];switch(t){case 0:return e.call(this,s);case 1:return e.call(this,n[0],s);case 2:return e.call(this,n[0],n[1],s)}var a=Array(t+1);for(r=-1;++r<t;)a[r]=n[r];return a[t]=s,e.apply(this,a)}}var i="Expected a function",o=Math.max;t.exports=r},{}],5:[function(e,t,n){function r(e,t,n){for(var r=-1,o=i(t),s=o.length;++r<s;){var a=o[r],u=e[a],c=n(u,t[a],a,e,t);(c===c?c===u:u!==u)&&(void 0!==u||a in e)||(e[a]=c)}return e}var i=e("../object/keys");t.exports=r},{"../object/keys":26}],6:[function(e,t,n){function r(e,t){return null==t?e:i(t,o(t),e)}var i=e("./baseCopy"),o=e("../object/keys");t.exports=r},{"../object/keys":26,"./baseCopy":7}],7:[function(e,t,n){function r(e,t,n){n||(n={});for(var r=-1,i=t.length;++r<i;){var o=t[r];n[o]=e[o]}return n}t.exports=r},{}],8:[function(e,t,n){function r(e){return function(t){return null==t?void 0:t[e]}}t.exports=r},{}],9:[function(e,t,n){function r(e,t,n){if("function"!=typeof e)return i;if(void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,o){return e.call(t,n,r,i,o)};case 5:return function(n,r,i,o,s){return e.call(t,n,r,i,o,s)}}return function(){return e.apply(t,arguments)}}var i=e("../utility/identity");t.exports=r},{"../utility/identity":28}],10:[function(e,t,n){function r(e){return s(function(t,n){var r=-1,s=null==t?0:n.length,a=s>2?n[s-2]:void 0,u=s>2?n[2]:void 0,c=s>1?n[s-1]:void 0;for("function"==typeof a?(a=i(a,c,5),s-=2):(a="function"==typeof c?c:void 0,s-=a?1:0),u&&o(n[0],n[1],u)&&(a=3>s?void 0:a,s=1);++r<s;){var l=n[r];l&&e(t,l,a)}return t})}var i=e("./bindCallback"),o=e("./isIterateeCall"),s=e("../function/restParam");t.exports=r},{"../function/restParam":4,"./bindCallback":9,"./isIterateeCall":15}],11:[function(e,t,n){var r=e("./baseProperty"),i=r("length");t.exports=i},{"./baseProperty":8}],12:[function(e,t,n){function r(e,t){var n=null==e?void 0:e[t];return i(n)?n:void 0}var i=e("../lang/isNative");t.exports=r},{"../lang/isNative":22}],13:[function(e,t,n){function r(e){return null!=e&&o(i(e))}var i=e("./getLength"),o=e("./isLength");t.exports=r},{"./getLength":11,"./isLength":16}],14:[function(e,t,n){function r(e,t){return e="number"==typeof e||i.test(e)?+e:-1,t=null==t?o:t,e>-1&&e%1==0&&t>e}var i=/^\d+$/,o=9007199254740991;t.exports=r},{}],15:[function(e,t,n){function r(e,t,n){if(!s(n))return!1;var r=typeof t;if("number"==r?i(n)&&o(t,n.length):"string"==r&&t in n){var a=n[t];return e===e?e===a:a!==a}return!1}var i=e("./isArrayLike"),o=e("./isIndex"),s=e("../lang/isObject");t.exports=r},{"../lang/isObject":23,"./isArrayLike":13,"./isIndex":14}],16:[function(e,t,n){function r(e){return"number"==typeof e&&e>-1&&e%1==0&&i>=e}var i=9007199254740991;t.exports=r},{}],17:[function(e,t,n){function r(e){return!!e&&"object"==typeof e}t.exports=r},{}],18:[function(e,t,n){function r(e){for(var t=u(e),n=t.length,r=n&&e.length,c=!!r&&a(r)&&(o(e)||i(e)),f=-1,p=[];++f<n;){var d=t[f];(c&&s(d,r)||l.call(e,d))&&p.push(d)}return p}var i=e("../lang/isArguments"),o=e("../lang/isArray"),s=e("./isIndex"),a=e("./isLength"),u=e("../object/keysIn"),c=Object.prototype,l=c.hasOwnProperty;t.exports=r},{"../lang/isArguments":19,"../lang/isArray":20,"../object/keysIn":27,"./isIndex":14,"./isLength":16}],19:[function(e,t,n){function r(e){return o(e)&&i(e)&&a.call(e,"callee")&&!u.call(e,"callee")}var i=e("../internal/isArrayLike"),o=e("../internal/isObjectLike"),s=Object.prototype,a=s.hasOwnProperty,u=s.propertyIsEnumerable;t.exports=r},{"../internal/isArrayLike":13,"../internal/isObjectLike":17}],20:[function(e,t,n){var r=e("../internal/getNative"),i=e("../internal/isLength"),o=e("../internal/isObjectLike"),s="[object Array]",a=Object.prototype,u=a.toString,c=r(Array,"isArray"),l=c||function(e){return o(e)&&i(e.length)&&u.call(e)==s};t.exports=l},{"../internal/getNative":12,"../internal/isLength":16,"../internal/isObjectLike":17}],21:[function(e,t,n){function r(e){return i(e)&&a.call(e)==o}var i=e("./isObject"),o="[object Function]",s=Object.prototype,a=s.toString;t.exports=r},{"./isObject":23}],22:[function(e,t,n){function r(e){return null==e?!1:i(e)?l.test(u.call(e)):o(e)&&s.test(e)}var i=e("./isFunction"),o=e("../internal/isObjectLike"),s=/^\[object .+?Constructor\]$/,a=Object.prototype,u=Function.prototype.toString,c=a.hasOwnProperty,l=RegExp("^"+u.call(c).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=r},{"../internal/isObjectLike":17,"./isFunction":21}],23:[function(e,t,n){function r(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}t.exports=r},{}],24:[function(e,t,n){function r(e){return"string"==typeof e||i(e)&&a.call(e)==o}var i=e("../internal/isObjectLike"),o="[object String]",s=Object.prototype,a=s.toString;t.exports=r},{"../internal/isObjectLike":17}],25:[function(e,t,n){var r=e("../internal/assignWith"),i=e("../internal/baseAssign"),o=e("../internal/createAssigner"),s=o(function(e,t,n){return n?r(e,t,n):i(e,t)});t.exports=s},{"../internal/assignWith":5,"../internal/baseAssign":6,"../internal/createAssigner":10}],26:[function(e,t,n){var r=e("../internal/getNative"),i=e("../internal/isArrayLike"),o=e("../lang/isObject"),s=e("../internal/shimKeys"),a=r(Object,"keys"),u=a?function(e){var t=null==e?void 0:e.constructor;return"function"==typeof t&&t.prototype===e||"function"!=typeof e&&i(e)?s(e):o(e)?a(e):[]}:s;t.exports=u},{"../internal/getNative":12,"../internal/isArrayLike":13,"../internal/shimKeys":18,"../lang/isObject":23}],27:[function(e,t,n){function r(e){if(null==e)return[];u(e)||(e=Object(e));var t=e.length;t=t&&a(t)&&(o(e)||i(e))&&t||0;for(var n=e.constructor,r=-1,c="function"==typeof n&&n.prototype===e,f=Array(t),p=t>0;++r<t;)f[r]=r+"";for(var d in e)p&&s(d,t)||"constructor"==d&&(c||!l.call(e,d))||f.push(d);return f}var i=e("../lang/isArguments"),o=e("../lang/isArray"),s=e("../internal/isIndex"),a=e("../internal/isLength"),u=e("../lang/isObject"),c=Object.prototype,l=c.hasOwnProperty;t.exports=r},{"../internal/isIndex":14,"../internal/isLength":16,"../lang/isArguments":19,"../lang/isArray":20,"../lang/isObject":23}],28:[function(e,t,n){function r(e){return e}t.exports=r},{}],29:[function(e,t,n){t.exports=function(e,t){var n;for(var r in t)t.hasOwnProperty(r)&&(n=t[r],null==n?e.removeAttribute(r):e.setAttribute(r,n))}},{}],30:[function(e,t,n){"use strict";function r(e,t){var n,r=t?o(t):{},a=i(e.authorization).attrs,u=o(e.analyticsMetadata);r.braintreeLibraryVersion=s.BRAINTREE_LIBRARY_VERSION;for(n in r._meta)r._meta.hasOwnProperty(n)&&(u[n]=r._meta[n]);return r._meta=u,a.clientKey?r.clientKey=a.clientKey:r.authorizationFingerprint=a.authorizationFingerprint,r}var i=e("./create-authorization-data"),o=e("./json-clone"),s=e("./constants");t.exports=r},{"./constants":35,"./create-authorization-data":37,"./json-clone":41}],31:[function(e,t,n){"use strict";function r(e){return Math.floor(e/1e3)}function i(e){return e}function o(e,t,n){var o=e.getConfiguration(),u=e._driver,c=r(Date.now()),l=o.gatewayConfiguration.analytics.url,f={analytics:[{kind:t,timestamp:c}]};u.post(l,a(o,f),i,n,s.ANALYTICS_REQUEST_TIMEOUT_MS)}var s=e("./constants"),a=e("./add-metadata");t.exports={sendEvent:o}},{"./add-metadata":30,"./constants":35}],32:[function(e,t,n){"use strict";function r(e,t){var n,r,o=document.createElement("a");return o.href=t,r="https:"===o.protocol?o.host.replace(/:443$/,""):"http:"===o.protocol?o.host.replace(/:80$/,""):o.host,n=o.protocol+"//"+r,n===e||i.test(e)}var i=/^https:\/\/([a-zA-Z0-9-]+\.)*(braintreepayments|braintreegateway|paypal)\.com(:\d{1,5})?$/;t.exports={checkOrigin:r}},{}],33:[function(e,t,n){"use strict";var r=e("../enumerate");t.exports=r(["CONFIGURATION_REQUEST"],"bus:")},{"../enumerate":39}],34:[function(e,t,n){"use strict";function r(e){if(e=e||{},this.channel=e.channel,!this.channel)throw new a({type:a.types.INTERNAL,message:"Channel ID must be specified."});this.merchantUrl=e.merchantUrl,this._isDestroyed=!1,this._isVerbose=!1,this._listeners=[],this._log("new bus on channel "+this.channel,[location.href])}var i=e("framebus"),o=e("./events"),s=e("./check-origin").checkOrigin,a=e("../error");r.prototype.on=function(e,t){var n,r,o=t,a=this;this._isDestroyed||(this.merchantUrl&&(o=function(){s(this.origin,a.merchantUrl)&&t.apply(this,arguments)}),n=this._namespaceEvent(e),r=Array.prototype.slice.call(arguments),r[0]=n,r[1]=o,this._log("on",r),i.on.apply(i,r),this._listeners.push({eventName:e,handler:o,originalHandler:t}))},r.prototype.emit=function(e){var t;this._isDestroyed||(t=Array.prototype.slice.call(arguments),t[0]=this._namespaceEvent(e),this._log("emit",t),i.emit.apply(i,t))},r.prototype._offDirect=function(e){var t=Array.prototype.slice.call(arguments);this._isDestroyed||(t[0]=this._namespaceEvent(e),this._log("off",t),i.off.apply(i,t))},r.prototype.off=function(e,t){var n,r,i=t;if(!this._isDestroyed){if(this.merchantUrl)for(n=0;n<this._listeners.length;n++)r=this._listeners[n],r.originalHandler===t&&(i=r.handler);this._offDirect(e,i)}},r.prototype._namespaceEvent=function(e){return["braintree",this.channel,e].join(":")},r.prototype.teardown=function(){var e,t;for(t=0;t<this._listeners.length;t++)e=this._listeners[t],this._offDirect(e.eventName,e.handler);this._listeners.length=0,this._isDestroyed=!0},r.prototype._log=function(e,t){this._isVerbose&&console.log(e,t)},r.events=o,t.exports=r},{"../error":40,"./check-origin":32,"./events":33,framebus:1}],35:[function(e,t,n){"use strict";var r="3.0.0-beta.7",i="web";t.exports={ANALYTICS_REQUEST_TIMEOUT_MS:2e3,INTEGRATION_TIMEOUT_MS:6e4,VERSION:r,INTEGRATION:"custom",SOURCE:"client",PLATFORM:i,BRAINTREE_LIBRARY_VERSION:"braintree/"+i+"/"+r}},{}],36:[function(e,t,n){"use strict";var r=e("./error");t.exports=function(e,t){t.forEach(function(t){e[t]=function(){throw new r({type:r.types.MERCHANT,message:t+" cannot be called after teardown."})}})}},{"./error":40}],37:[function(e,t,n){"use strict";function r(e){return/^[a-zA-Z0-9]+_[a-zA-Z0-9]+_[a-zA-Z0-9_]+$/.test(e)}function i(e){var t=e.split("_"),n=t[0],r=t.slice(2).join("_");return{merchantId:r,environment:n}}function o(e){var t,n,o={attrs:{},configUrl:""};return r(e)?(n=i(e),o.attrs.clientKey=e,o.configUrl=a[n.environment]+"/merchants/"+n.merchantId+"/client_api/v1/configuration"):(t=JSON.parse(s(e)),o.attrs.authorizationFingerprint=t.authorizationFingerprint,o.configUrl=t.configUrl),o}var s=e("../lib/polyfill").atob,a={production:"https://api.braintreegateway.com:443",sandbox:"https://api.sandbox.braintreegateway.com:443"};t.exports=o},{"../lib/polyfill":43}],38:[function(e,t,n){"use strict";t.exports=function(e){return function(){var t=arguments;setTimeout(function(){e.apply(null,t)},1)}}},{}],39:[function(e,t,n){"use strict";function r(e,t){return t=null==t?"":t,e.reduce(function(e,n){return e[n]=t+n,e},{})}t.exports=r},{}],40:[function(e,t,n){"use strict";function r(e){if(!r.types.hasOwnProperty(e.type))throw new Error(e.type+" is not a valid type.");if(!e.message)throw new Error("Error message required.");this.message=e.message,this.type=e.type,this.details=e.details}var i=e("./enumerate");r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r.types=i(["CUSTOMER","MERCHANT","NETWORK","INTERNAL","UNKNOWN"]),t.exports=r},{"./enumerate":39}],41:[function(e,t,n){"use strict";t.exports=function(e){return JSON.parse(JSON.stringify(e))}},{}],42:[function(e,t,n){"use strict";t.exports=function(e){return Object.keys(e).filter(function(t){return"function"==typeof e[t]})}},{}],43:[function(e,t,n){(function(e){"use strict";function n(e){var t,n,r,i,o,s,a,u,c=new RegExp("^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{4})([=]{1,2})?$"),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",f="";if(!c.test(e))throw new Error("Non base64 encoded input passed to window.atob polyfill");u=0;do i=l.indexOf(e.charAt(u++)),o=l.indexOf(e.charAt(u++)),s=l.indexOf(e.charAt(u++)),a=l.indexOf(e.charAt(u++)),t=(63&i)<<2|o>>4&3,n=(15&o)<<4|s>>2&15,r=(3&s)<<6|63&a,f+=String.fromCharCode(t)+(n?String.fromCharCode(n):"")+(r?String.fromCharCode(r):"");while(u<e.length);return f}var r="function"==typeof e.atob?e.atob:n;t.exports={atob:r,_atob:n}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],44:[function(e,t,n){"use strict";function r(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})}t.exports=r},{}],45:[function(e,t,n){"use strict";function r(e,t){var n;if("function"!=typeof t)throw new s({type:s.types.MERCHANT,message:"UnionPay creation requires a callback."});return t=u(t),null==e.client?void t(new s({type:s.types.MERCHANT,message:"options.client is required when instantiating UnionPay."})):(n=e.client.getConfiguration(),n.gatewayConfiguration.unionPay&&n.gatewayConfiguration.unionPay.enabled===!0?(a.sendEvent(e.client,"web.unionpay.initialized"),void t(null,new o(e))):void t(new s({type:s.types.MERCHANT,message:"UnionPay is not enabled for this merchant."})))}var i="3.0.0-beta.7",o=e("./shared/unionpay"),s=e("../lib/error"),a=e("../lib/analytics"),u=e("../lib/deferred");t.exports={create:r,VERSION:i}},{"../lib/analytics":31,"../lib/deferred":38,"../lib/error":40,"./shared/unionpay":47}],46:[function(e,t,n){"use strict";var r=e("../../lib/enumerate");t.exports={events:r(["HOSTED_FIELDS_FETCH_CAPABILITIES","HOSTED_FIELDS_ENROLL","HOSTED_FIELDS_TOKENIZE"],"union-pay:"),HOSTED_FIELDS_FRAME_NAME:"braintreeunionpayhostedfields",INVALID_HOSTED_FIELDS_ERROR_MESSAGE:"Found an invalid Hosted Fields instance. Please use a valid Hosted Fields instance.",CARD_OR_HOSTED_FIELDS_REQUIRED_ERROR_MESSAGE:"A card or a Hosted Fields instance is required. Please supply a card or a Hosted Fields instance.",CARD_AND_HOSTED_FIELDS_ERROR_MESSAGE:"Please supply either a card or a Hosted Fields instance, not both.",NO_HOSTED_FIELDS_ERROR_MESSAGE:"Could not find the Hosted Fields instance."}},{"../../lib/enumerate":39}],47:[function(e,t,n){"use strict";function r(e){this._options=e}var i=e("../../lib/error"),o=e("../../lib/bus"),s=e("../../lib/analytics"),a=e("iframer"),u=e("../../lib/uuid"),c=e("../../lib/methods"),l=e("../../lib/deferred"),f=e("../../lib/convert-methods-to-error"),p="3.0.0-beta.7",d=e("./constants"),y=d.events;r.prototype.fetchCapabilities=function(e,t){var n=this._options.client,r=e.card?e.card.number:null,o=e.hostedFields;if(t=l(t),r&&o)return void t(new i({type:i.types.MERCHANT,message:d.CARD_AND_HOSTED_FIELDS_ERROR_MESSAGE}));if(r)n.request({method:"get",endpoint:"payment_methods/credit_cards/capabilities",data:{_meta:{source:"unionpay"},creditCard:{number:r}}},function(e,r){return e?(t(new i({type:i.types.NETWORK,message:"Fetch capabilities network error.",details:{originalError:e}})),void s.sendEvent(n,"web.unionpay.capabilities-failed")):(s.sendEvent(n,"web.unionpay.capabilities-received"),void t(null,r))});else{if(!o)return void t(new i({type:i.types.MERCHANT,message:d.CARD_OR_HOSTED_FIELDS_REQUIRED_ERROR_MESSAGE}));if(!o._bus)return void t(new i({type:i.types.MERCHANT,message:d.INVALID_HOSTED_FIELDS_ERROR_MESSAGE}));this._initializeHostedFields(function(){this._bus.emit(y.HOSTED_FIELDS_FETCH_CAPABILITIES,{hostedFields:o},function(e){return e.err?void t(new i(e.err)):void t(null,e.payload)})}.bind(this))}},r.prototype.enroll=function(e,t){var n,r=this._options.client,o=e.card,a=e.mobile,u=e.hostedFields;if(t=l(t),!a)return void t(new i({type:i.types.MERCHANT,message:"A `mobile` with `countryCode` and `number` is required."}));if(u){if(!u._bus)return void t(new i({type:i.types.MERCHANT,message:d.INVALID_HOSTED_FIELDS_ERROR_MESSAGE}));if(o)return void t(new i({type:i.types.MERCHANT,message:d.CARD_AND_HOSTED_FIELDS_ERROR_MESSAGE}));this._initializeHostedFields(function(){this._bus.emit(y.HOSTED_FIELDS_ENROLL,{hostedFields:u,mobile:a},function(e){return e.err?void t(new i(e.err)):void t(null,e.payload)})}.bind(this))}else{if(!o||!o.number)return void t(new i({type:i.types.MERCHANT,message:d.CARD_OR_HOSTED_FIELDS_REQUIRED_ERROR_MESSAGE}));if(n={_meta:{source:"unionpay"},unionPayEnrollment:{number:o.number,mobileCountryCode:a.countryCode,mobileNumber:a.number}},o.expirationMonth||o.expirationYear){if(!o.expirationMonth||!o.expirationYear)return void t(new i({type:i.types.MERCHANT,message:"You must supply expiration month and year or neither."}));n.unionPayEnrollment.expirationYear=o.expirationYear,n.unionPayEnrollment.expirationMonth=o.expirationMonth}r.request({method:"post",endpoint:"union_pay_enrollments",data:n},function(e,n){var o;return e?(e.type===i.types.CUSTOMER?o="Enrollment invalid due to customer input error.":(e.type=i.types.NETWORK,o="An enrollment network error occurred."),s.sendEvent(r,"web.unionpay.enrollment-failed"),void t(new i({type:e.type,message:o,details:{originalError:e}}))):(s.sendEvent(r,"web.unionpay.enrollment-succeeded"),void t(null,{enrollmentId:n.unionPayEnrollmentId}))})}},r.prototype.tokenize=function(e,t){var n,r,o=this._options.client,a=e.card,u=e.hostedFields;if(t=l(t),a&&u)return void t(new i({type:i.types.MERCHANT,message:d.CARD_AND_HOSTED_FIELDS_ERROR_MESSAGE}));if(a)n={_meta:{source:"unionpay"},creditCard:{number:e.card.number,expirationMonth:e.card.expirationMonth,expirationYear:e.card.expirationYear},options:{id:e.enrollmentId,smsCode:e.smsCode}},e.card.cvv&&(n.creditCard.cvv=e.card.cvv),o.request({method:"post",endpoint:"payment_methods/credit_cards",data:n},function(e,n){return e?(s.sendEvent(o,"web.unionpay.nonce-failed"),void t(new i({type:i.types.NETWORK,message:"Tokenization network error",details:{originalError:e}}))):(r=n.creditCards[0],delete r.consumed,delete r.threeDSecureInfo,delete r.type,s.sendEvent(o,"web.unionpay.nonce-received"),void t(null,r))});else{if(!u)return void t(new i({type:i.types.MERCHANT,message:d.CARD_OR_HOSTED_FIELDS_REQUIRED_ERROR_MESSAGE}));if(!u._bus)return void t(new i({type:i.types.MERCHANT,message:d.INVALID_HOSTED_FIELDS_ERROR_MESSAGE}));this._initializeHostedFields(function(){this._bus.emit(y.HOSTED_FIELDS_TOKENIZE,{hostedFields:u,options:e},function(e){return e.err?void t(new i(e.err)):void t(null,e.payload)})}.bind(this))}},r.prototype.teardown=function(e){this._bus&&(this._hostedFieldsFrame.parentNode.removeChild(this._hostedFieldsFrame),this._bus.teardown()),f(this,c(r.prototype)),"function"==typeof e&&(e=l(e))()},r.prototype._initializeHostedFields=function(e){var t=u();return this._bus?void e():(this._bus=new o({channel:t,merchantUrl:location.href}),this._hostedFieldsFrame=a({name:d.HOSTED_FIELDS_FRAME_NAME+"_"+t,src:this._options.client.getConfiguration().gatewayConfiguration.assetsUrl+"/web/"+p+"/html/unionpay-hosted-fields-frame.min.html",height:0,width:0}),this._bus.on(o.events.CONFIGURATION_REQUEST,function(t){t(this._options.client),e()}.bind(this)),void document.body.appendChild(this._hostedFieldsFrame))},t.exports=r},{"../../lib/analytics":31,"../../lib/bus":34,"../../lib/convert-methods-to-error":36,"../../lib/deferred":38,"../../lib/error":40,"../../lib/methods":42,"../../lib/uuid":44,"./constants":46,iframer:2}]},{},[45])(45)});
